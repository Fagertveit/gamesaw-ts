<!DOCTYPE html>
<html>
<head>
    <title>GameSaw Game Library</title>
    <script src="../../dist/gamesaw.js"></script>
    <style>
        .container {
            width: 1200px;
            margin: 10px auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>GameSaw Game Library</h1>
        <div id="gamesaw-container">

        </div>
    </div>

<script>
    var app = new gamesaw.Application(64, 64, 10, 640, 480);
    var testScene = app.sceneManager.addScene('test');
    var ctx = app.surface.getContext();
    ctx.clearColor(0, 0, 0, 1);
    var renderer = gamesaw.GL.Render2d.Renderer2d.getInstance();
    renderer.init();
    var texture = new gamesaw.GL.Texture('../img/pixel.png');
    var sprite = new gamesaw.GL.Sprite(texture, 64, 64);
    sprite.setUV(0.0, 0.0, 1.0, 1.0);

    var particleRenderer = new gamesaw.GL.Particle.ParticleRenderer();
    var particle = new gamesaw.GL.Texture('../img/pixel_particle.png');
    var emitter = new gamesaw.GL.Particle.ParticleEmitter();

    var mouse = gamesaw.Input.Mouse.getInstance();
    mouse.init();

    emitter.setup(
        particle,
        new gamesaw.Geometry.Point(32, 32),
        new gamesaw.Geometry.Point(-0.3, -0.8), new gamesaw.Geometry.Point(0.3, -0.7),
        5.0, 3.0,
        8, 4,
        1000, 800,
        0.2,
        0.0,
        0.0,
        0.0,
        0,
        10,
        0,
        true,
        new gamesaw.Graphics.Color(240, 175, 25, 0.4)
    );

    testScene.render = function(delta) {
        ctx.clear(ctx.COLOR_BUFFER_BIT | ctx.DEPTH_BUFFER_BIT);
        particleRenderer.generateFBO(emitter);

        sprite.render(0, 0);

        renderer.execute();

        var particleSprite = new gamesaw.GL.Sprite(particleRenderer.fbo, 64, 64, [0, 0, 64, 64]);
        particleSprite.render(0, 0);
        renderer.setRenderMode(ctx.SRC_ALPHA, ctx.ONE);
        renderer.execute();
        renderer.setRenderMode(ctx.SRC_ALPHA, ctx.ONE_MINUS_SRC_ALPHA);
    };
    testScene.update = function(delta) {
        // emitter.pos = new gamesaw.Geometry.Point(mouse.x, mouse.y);
        emitter.update(delta);

        if (mouse.button[0]) {
            console.log('Clicked at ' + mouse.x + ' : ' + mouse.y);
            mouse.button[0] = false;
        }
    };

    app.init();
</script>
</body>
</html>
